<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="../assets/libs/css/newprofile.css"> -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <link
      rel="icon"
      href="../assets/images/header-logo2.png"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="../assets/vendors/bootstrap/css/bootstrap.min.css"
    />
    <link
      href="../assets/vendors/fonts/circular-std/style.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/libs/css/style.css" />

    <link
      rel="stylesheet"
      href="../assets/vendors/fonts/fontawesome/css/fontawesome-all.css"
    />
    <link
      rel="stylesheet"
      href="../assets/vendors/charts/chartist-bundle/chartist.css"
    />
    <link
      rel="stylesheet"
      href="../assets/vendors/charts/morris-bundle/morris.css"
    />
    <link
      rel="stylesheet"
      href="../assets/vendors/fonts/material-design-iconic-font/css/materialdesignicons.min.css"
    />
    <link rel="stylesheet" href="../assets/vendors/charts/c3charts/c3.css" />
    <link
      rel="stylesheet"
      href="../assets/vendors/fonts/flag-icon-css/flag-icon.min.css"
    />
    <script
      src="https://kit.fontawesome.com/28d953b416.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-storage.js"></script>
    <script src="../js/connect.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="stylesheet" type="text/css" href="payment.css" />
    <script>
      function openNav() {
        document.getElementById("mySidebar").style.width = "220px";
        //   document.getElementById("main").style.marginLeft = "250px";
      }

      function closeNav() {
        document.getElementById("mySidebar").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
      }
    </script>

    <title>Meritbothi | Manage-Institute's</title>
  </head>

  <body onload="onLoadSetter()">
    <!-- ============================================================== -->
    <!-- main wrapper -->
    <!-- ============================================================== -->
    <div class="dashboard-main-wrapper">
      <!-- ============================================================== -->
      <!-- navbar -->
      <!-- ============================================================== -->
      <div class="dashboard-header">
        <nav class="navbar topbar-rr navbar-expand-lg bg-white fixed-top">
          <div id="main1">
            <button class="openbtn" onclick="openNav()">â˜°</button>
          </div>
          <a class="navbar-brand" href="index.html" style="font-size: 23px"
            >Meritbothi</a
          >
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto navbar-right-top">
              <li class="nav-item dropdown notification">
                <a
                  class="nav-link nav-icons"
                  href="#"
                  id="navbarDropdownMenuLink1"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                  ><i class="fas fa-fw fa-bell"></i> <span>5</span>
                </a>
                <ul
                  class="dropdown-menu dropdown-menu-right notification-dropdown"
                >
                  <li>
                    <div class="notification-title">Notification</div>
                    <div class="notification-list">
                      <div class="list-group">
                        <a
                          href="#"
                          class="list-group-item list-group-item-action active"
                        >
                          <div class="notification-info">
                            <div class="notification-list-user-img">
                              <img
                                src="../assets/images/avatar-2.jpg"
                                alt=""
                                class="user-avatar-md rounded-circle"
                              />
                            </div>
                            <div class="notification-list-user-block">
                              <span class="notification-list-user-name"
                                >Kishor</span
                              >accepted your invitation to join the team.
                              <div class="notification-date">2 min ago</div>
                            </div>
                          </div>
                        </a>
                        <a
                          href="#"
                          class="list-group-item list-group-item-action"
                        >
                          <div class="notification-info">
                            <div class="notification-list-user-img">
                              <img
                                src="../assets/images/avatar-3.jpg"
                                alt=""
                                class="user-avatar-md rounded-circle"
                              />
                            </div>
                            <div class="notification-list-user-block">
                              <span class="notification-list-user-name"
                                >Bharath </span
                              >is now following you
                              <div class="notification-date">2 days ago</div>
                            </div>
                          </div>
                        </a>
                        <a
                          href="#"
                          class="list-group-item list-group-item-action"
                        >
                          <div class="notification-info">
                            <div class="notification-list-user-img">
                              <img
                                src="../assets/images/avatar-4.jpg"
                                alt=""
                                class="user-avatar-md rounded-circle"
                              />
                            </div>
                            <div class="notification-list-user-block">
                              <span class="notification-list-user-name"
                                >Sudhersun</span
                              >
                              is watching your main repository
                              <div class="notification-date">2 min ago</div>
                            </div>
                          </div>
                        </a>
                        <a
                          href="#"
                          class="list-group-item list-group-item-action"
                        >
                          <div class="notification-info">
                            <div class="notification-list-user-img">
                              <img
                                src="../assets/images/avatar-5.jpg"
                                alt=""
                                class="user-avatar-md rounded-circle"
                              />
                            </div>
                            <div class="notification-list-user-block">
                              <span class="notification-list-user-name"
                                >Sandy</span
                              >accepted your invitation to join the team.
                              <div class="notification-date">2 min ago</div>
                            </div>
                          </div>
                        </a>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-footer">
                      <a href="#">View all notifications</a>
                    </div>
                  </li>
                </ul>
              </li>

              <li class="nav-item dropdown nav-user">
                <a
                  class="nav-link nav-user-img"
                  href="#"
                  id="navbarDropdownMenuLink2"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                  ><img
                    src="../assets/images/avatar-1.jpg"
                    alt=""
                    class="user-avatar-md rounded-circle"
                    id="smallProfileImage"
                /></a>
                <div
                  class="dropdown-menu dropdown-menu-right nav-user-dropdown"
                  aria-labelledby="navbarDropdownMenuLink2"
                >
                  <div class="nav-user-info">
                    <h5 class="mb-0 text-white nav-user-name" id="iName">
                      Black
                    </h5>
                    <span class="status"></span
                    ><span class="ml-2">Available</span>
                  </div>
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-user mr-2"></i>Account</a
                  >
                  <a class="dropdown-item" href="#"
                    ><i class="fas fa-cog mr-2"></i>Setting</a
                  >
                  <a class="dropdown-item" onclick="logout()" href="#"
                    ><i class="fas fa-power-off mr-2"></i>Logout</a
                  >
                </div>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <!-- ============================================================== -->
      <!-- end navbar -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- left sidebar -->
      <!-- ============================================================== -->

      <div id="mySidebar" class="sidebar" style="width: 220px">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Ã—</a>
        <ul class="navbar-nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="../manage-dashboard"
              ><i class="fas fa-chart-pie"></i>Dashboard</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="../manage-institute"
              ><i class="fas fa-university"></i>Institute's</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="../manage-faculty"
              ><i class="fas fa-chalkboard-teacher"></i>Faculty</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="../manage-courses"
              ><i class="fas fa-book"></i>Courses</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="../manage-content"
              ><i class="fas fa-image"></i> Content</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="../manage-category"
              ><i class="fas fa-sort-amount-down"></i>Category</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="../manage-payments"
              ><i class="fas fa-credit-card"></i>Payments</a
            >
          </li>

          <!-- <li class="nav-item">
            <a class="nav-link" href="../manage-report"
              ><i class="fas fa-flag"></i>Report Generation</a
            >
          </li> -->

          <li class="nav-item">
            <a class="nav-link" href="../manage-complaints"
              ><i class="fas fa-question-circle"></i>Complaints</a
            >
          </li>

          <!-- <li class="nav-item">
            <a class="nav-link" href="../manage-addadmins"
              ><i class="fas fa-plus-square"></i>Add Admins</a
            >
          </li> -->

          <li class="nav-item hi-sh-lg">
            <a class="nav-link" href="#" onclick="logout()"
              ><i class="fas fa-power-off"></i>Logout</a
            >
          </li>
        </ul>
      </div>

      <!-- ============================================================== -->
      <!-- end left sidebar -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
      <!-- wrapper  -->
      <!-- ============================================================== -->
      <div class="dashboard-wrapper">
        <div class="dashboard-ecommerce">
          <div class="container-fluid dashboard-content">
            <div class="ecommerce-widget">
              <!-- rowstart -->

              

              <!-- rowend -->

              <div class="row">
                <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                  <div class="card">
                    <div class="card-body">
                      <h2 style="color: #5e72e4">Total Pending</h2>
                      <div class="metric-value d-inline-block">
                        <h3 class="mb-1" id="courseCount">500 Rupees</h3>
                      </div>
                      <div class="metric-label d-inline-block float-right text-secondary font-weight-bold">
                        <span><i class="fa-solid fa-indian-rupee-sign"></i></span>
                    </div>
                    </div>
                    <div id="sparkline-revenue"></div>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                  <div class="card">
                    <div class="card-body">
                      <h2 style="color: #5e72e4">Institution</h2>
                      <div class="metric-value d-inline-block">
                        <h3 class="mb-1" id="facultyCount">000</h3>
                      </div>
                      <div class="metric-label d-inline-block float-right text-secondary font-weight-bold">
                        <span><i class="fa-solid fa-indian-rupee-sign"></i></span>
                    </div>
                    </div>
                    <div id="sparkline-revenue2"></div>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                  <div class="card">
                    <div class="card-body">
                      <h2 style="color: #5e72e4">Meritbothi</h2>
                      <div class="metric-value d-inline-block">
                        <h3 class="mb-1" id="studentCount">000</h3>
                      </div>
                      <div class="metric-label d-inline-block float-right text-secondary font-weight-bold">
                        <span><i class="fa-solid fa-indian-rupee-sign"></i></span>
                    </div>
                    </div>
                    <div id="sparkline-revenue3"></div>
                  </div>
                </div>
                <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                  <div class="card">
                    <div class="card-body">
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" style="display: block;">
                        <label class="form-check-label" for="flexRadioDefault1">
                         Monthly
                        </label>  
                      </div>
                      <input class="dateandtime" type="month" name="flexRadioDefault1" id="flexRadioDefault1" style="display: block;">
                      <div class="form-check mt-2 mb-2">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" style="display: block;">
                        <label class="form-check-label" for="flexRadioDefault2">
                          Yearly
                        </label>
                      </div>
                      <input class="dateandtime" type="text" name="flexRadioDefault1" id="flexRadioDefault1" style="display: block;">
                      <button type="button" class="btn apply mt-2"> Apply</button>
                    </div>  
                    </div>
                    <div id="sparkline-revenue4"></div>
                  </div>
                </div>
              </div>

              <!--recent table-->
              <div class="row">
                <div style="width: 100%; margin-left: 15px; margin-right: 15px">
                  <div class="card">
                    <!-- <div class="row headder"> -->
                    <h5 class="card-header" style="display: flex;
                    justify-content: space-between;
                    align-items: center;">Institute Payment Details
                      <button type="button" id="btnExport" onclick="exportReportToExcel(this)" class="btn export"> Export</button>
                    </h5>
                   
                  <!-- </div> -->
                    <div class="card-body p-0">
                      <div class="table-responsive">
                        <table class="table">
                          <thead class="bg-light">
                            <tr class="border-0">
                              <th class="border-0">SI no</th>
                              <th class="border-0">Institute Name</th>
                              <th class="border-0">Amount for us</th>
                              <th class="border-0">Amount to be paid</th>
                              <th class="border-0">Pending</th>
                              <th class="border-0">Paid Date</th>
                              <th class="border-0">View Account Details</th>
                              <th class="border-0">Payment Details</th>
                            </tr>
                          </thead>
                          <tbody id="orderTab">
                         
                          </tbody>
                          <tr>
                            <td colspan="9">
                              <a
                                href="#"
                                class="btn btn-outline-light float-right"
                                >View More</a
                              >
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- ============================================================== -->
              <!-- end recent orders  -->
              

              
              <!-- ============================================================== -->
              <!-- end sales traffice country source  -->
              <!-- ============================================================== -->
            </div>
          </div>
        </div>
      </div>
      <!-- ============================================================== -->
      <!-- end wrapper  -->
      <!-- ============================================================== -->
    </div>

    <div id="myModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <h2>Payment Detail <span class="close">&times;</span></h2>
        <div class="row">
          <div class="col-md-4">
        <h3>Bank Details</h3>
        <p><b>Name : </b><span>Jagadish</span></p>
        <p><b>Phone no : </b><span>1234567890</span></p>
        <p><b>Account no : </b><span>xxxxxxxxxxx</span></p>
        <p><b>IFSC : </b><span>INDO1234</span></p>
        <p><b>Branch : </b><span>avadi,chennai</span></p>
      </div>
      <div class="col-md-4">
        <h3>Upi Detail</h3>
        <p><b>Upi id : </b><span>Jagadish@upi</span></p>
      </div>
      <div class="col-md-4">
        <p><b>Amount to paid : </b><span>200 <i class="fa-solid fa-indian-rupee-sign"></i>/-</span></p>
        <p><b>GST : </b><span>12%</span></p>
        <p><b>Total Amount to paid  : </b><span>250 <i class="fa-solid fa-indian-rupee-sign"></i>/-</span></p>
        <form>
          <div class="form-group">
            <label for="exampleInputEmail1">Amount paid</label>
            <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" >
          </div>
        </form>
             <button type="submit" class="btn sub">Paid</button>
             <button type="submit" class="btn can modalclose" >Cancel</button>
      </div>

      </div>
      </div>
    
    </div>
    <!-- ============================================================== -->
    <!-- end main wrapper  -->

    <script src="../assets/vendors/charts/morris-bundle/raphael.min.js"></script>
    <script src="../assets/vendors/charts/morris-bundle/morris.js"></script>

    <script src="../assets/vendors/jquery/jquery-3.3.1.min.js"></script>
    <script src="../assets/vendors/bootstrap/js/bootstrap.bundle.js"></script>
    <script src="../assets/vendors/charts/chartist-bundle/chartist.min.js"></script>
    <!-- sparkline js -->
    <script src="../assets/vendors/charts/sparkline/jquery.sparkline.js"></script>
    <!-- morris js -->

    <!-- chart c3 js -->
    <script src="../assets/vendors/charts/c3charts/c3.min.js"></script>
    <script src="../assets/vendors/charts/c3charts/d3-5.4.0.min.js"></script>
    <script src="../assets/vendors/charts/c3charts/C3chartjs.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/react@16.12/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@16.12/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prop-types@15.7.2/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-apexcharts@1.3.6/dist/react-apexcharts.iife.min.js"></script>
    <script>
      var subCategories = [];
      var institutes = [];
      var faculties = [];
      var students = [];
      var courses = [];
      var courseCountter = 0;
      auth.onAuthStateChanged((user) => {
        if (user) {
        } else {
          location.replace("../admin-login/");
        }
      });
      onLoadSetter = () => {
        data
          .collection("subCategories")
          .get()
          .then((cats) => {
            cats.forEach((cat) => {
              subCategories.push(cat.id);
            });
          })
          .then(() => {
            courseGetter(subCategories);
            data
              .collection("institute")
              .get()
              .then((ins) => {
                ins.forEach((inst) => {
                  institutes.push(inst.data());
                });
              })
              .then(() => {
                data
                  .collection("faculty")
                  .get()
                  .then((facs) => {
                    facs.forEach((fac) => {
                      faculties.push(fac.data());
                    });
                  })
                  .then(() => {
                    data
                      .collection("students")
                      .get()
                      .then((stds) => {
                        stds.forEach((std) => {
                          students.push(std.data());
                        });
                      })
                      .then(() => {
                        console.log(institutes);
                        console.log(faculties);
                        console.log(subCategories);
                        console.log(courses);
                        console.log(students.length);
                        document.getElementById("studentCount").innerHTML =
                          students.length;
                        document.getElementById("facultyCount").innerHTML =
                          faculties.length;
                        document.getElementById("instituteCount").innerHTML =
                          institutes.length;
                        document.getElementById("courseCount").innerHTML =
                          courseCountter;
                      })
                  });
              });
          });
          //Get institute details from firestore
          data.collection('institute').get().then((instituteDetailArray)=>{
  
          //MApping institute details
          let i =0;
          instituteDetailArray.forEach((detail)=> {
            let revenueDetail = detail.data()?.revenueDetails;
            //Appending payment details to the table body
            $('#orderTab').append(`<tr>
                      // <th scope="row">`+(i+1)+`</th>
                      <td>`+detail.data()?.instituteName+`</td>
                      <td>`+revenueDetail?.currentMeritbodhiRevenue+`</td>
                      <td>`+revenueDetail?.currentInstituteRevenue+`</td>
                      <td>`+revenueDetail?.pendingAmount+`</td>
                      <td>`+revenueDetail?.lastPaymentDate+`</td>
                      <td class="text-center">
                      <button type="button" class="btn view" onclick="openModal(`+ detail.data() +`)">View</button>
                      </td>
                      <td class="text-center">
                      <button type="button" class="btn view" onclick="openModal()">View</button>
                      </td>
                    </tr>`);
                    i++;
        });
          })


      };
      courseGetter = (cats) => {
        console.log(cats.length);
        cats.forEach((scat) => {
          data
            .collection("subCategories")
            .doc(scat)
            .collection("courses")
            .get()
            .then((crs) => {
              crs.forEach((cr) => {
                courses.push(cr.data());
                courseCountter++;
              });
            });
        });
      };
      
      logout = () => {
        auth.signOut().then(() => {
          localforage.clear().then(() => {
            sessionStorage.clear();
            location.replace("https://meritbodhi.com/admin-login");
          });
        });
      };

      var modal = document.getElementById("myModal");
      var span = document.getElementsByClassName("close")[0];
      var closemodal = document.getElementsByClassName("modalclose")[0];
      openModal = (data) => {
        console.log('Data>>>', data);

          // modal.style.display = "block";
        
      };
      
      span.onclick = function() {
        modal.style.display = "none";
      }

      closemodal.onclick = function() {
        modal.style.display = "none";
      }
      
      
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }


      function exportReportToExcel() {
  let table = document.getElementsByTagName("table"); // you can use document.getElementById('tableId') as well by providing id to the table tag
  TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
    name: `export.xlsx`, // fileName you could use any name
    sheet: {
      name: 'Sheet 1' // sheetName
    }
  });
}


    </script>
  </body>
  <!-- primary color : #5e72e4 -->
</html>
